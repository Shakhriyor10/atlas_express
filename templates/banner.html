{# templates/partials/banner_section.html #}
{% load static %}
{% load i18n %}
<section class="banner-section blue gradient-hero" id="bannerCarousel"
         style="background-image: url({% static 'images/background/avia2.jpg' %})">
                <div class="auto-container">
                        <div class="row clearfix">
                                <!-- Content Column -->
                                <div class="content-column col-lg-7 col-md-12 col-sm-12 d-flex align-items-center">
                                        <div class="inner-column wow slideInLeft" data-wow-delay="0ms" data-wow-duration="1500ms">
                                                <h1>{% trans '–õ—É—á—à–∏–π –≤ –º–∏—Ä–µ –ø–æ—Å—Ç–∞–≤—â–∏–∫ –ª–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–∏—Ö —É—Å–ª—É–≥' %}</h1>
                                                <div class="text">{% trans '–ú—ã —è–≤–ª—è–µ–º—Å—è –≥–∏–±–∫–∏–º –∏ –ø—Ä–µ–¥–∞–Ω–Ω—ã–º –ø–∞—Ä—Ç–Ω–µ—Ä–æ–º –ø–æ –ª–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–∏–º —É—Å–ª—É–≥–∞–º. –ú—ã —Ä–∞–±–æ—Ç–∞–µ–º —Å –≤–∞–º–∏, —á—Ç–æ–±—ã —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è.' %}</div>
                                        </div>
                                </div>

                                <!-- Form Column -->
                                <div class="form-column col-lg-5 col-md-12 col-sm-12">
                                        <div class="inner-column wow slideInRight" data-wow-delay="0ms" data-wow-duration="1500ms">
                                                <h2>{% trans '–ü–æ–∏—Å–∫ –ø–æ—Å—ã–ª–æ–∫' %}</h2>

                                                <!-- Banner Form -->
                                                <div class="banner-form">
                                                        <form id="track-form" method="post" action="{% url 'track_package' %}">
								{% csrf_token %}
								<div class="form-group">
									<input type="text" name="trackid" placeholder="{% trans '–í–≤–µ–¥–∏—Ç–µ ID –ø–æ—Å—ã–ª–∫–∏' %}" required>
								</div>

								<div class="form-group">
									<button type="submit" class="theme-btn btn-style-one">{% trans '–ü–æ–∏—Å–∫' %}</button>
								</div>
							</form>

							<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ Bootstrap 4 -->
							<!-- ‚Ä¶–≥–¥–µ-—Ç–æ –≤ –∫–æ–Ω—Ü–µ body‚Ä¶ -->
<!-- ========== –Ø–†–ö–ê–Ø –ú–û–î–ê–õ–ö–ê ========== -->

<!-- ========== /–Ø–†–ö–ê–Ø –ú–û–î–ê–õ–ö–ê ========== -->

<!--							Estimate Cost For Your Shipments-->
						</div>
						<!-- End Banner Form -->

					</div>
				</div>

			</div>
		</div>
	</section>


<script>
document.getElementById("track-form").addEventListener("submit", function(e) {
    e.preventDefault();
    const form = e.target, fd = new FormData(form);

    fetch(form.action, {
        method: "POST",
        headers: {
            "X-Requested-With": "XMLHttpRequest",
            "X-CSRFToken": fd.get("csrfmiddlewaretoken")
        },
        body: fd
    })
    .then(response => {
				if (!response.ok) {
					// –µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É (400, 404 –∏ —Ç.–¥.)
					document.getElementById("modalBody").innerHTML =
					  `<div class="alert alert-warning text-center">
						 {% trans '–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ' %}
					   </div>`;
					$('#resultModal').modal('show');
					// —á—Ç–æ–±—ã –¥–∞–ª—å—à–µ .then(data) –Ω–µ –≤—ã–ø–æ–ª–Ω—è–ª—Å—è
					throw new Error("not found");
				}
				return response.json();
			})
				.then(data => {
		  if (data.error) throw new Error(data.error);

		  // –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∏ –¥–∞—Ç (–≤–∞—à–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –ª–æ–≥–∏–∫–∞)
		  let statusText;
		  switch (data.status) {
			case "in_warehouse":    statusText = "{% trans '–ù–∞ —Å–∫–ª–∞–¥–µ' %}"; break;
			case "location":        statusText = "{% trans '–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ' %}"; break;
			case "packed":          statusText = "{% trans '–£–ø–∞–∫–æ–≤–∞–Ω' %}"; break;
			case "shipped":         statusText = "{% trans '–û—Ç–ø—Ä–∞–≤–ª–µ–Ω' %}"; break;
			case "in_customs":      statusText = "{% trans '–ù–∞ —Ç–∞–º–æ–∂–Ω–µ' %}"; break;
			case "arrive_warehouse":statusText = "{% trans '–ü—Ä–∏–±—ã–ª –Ω–∞ —Å–∫–ª–∞–¥' %}"; break;
			case "accept_location": statusText = "{% trans '–ü—Ä–∏–Ω—è—Ç–æ –≤ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ' %}"; break;
			case "delivered":       statusText = "{% trans '–î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ' %}"; break;
			default:                statusText = data.status;
		  }

		  let dateLabel  = "{% trans '–î–∞—Ç–∞ –ø—Ä–∏–±—ã—Ç–∏—è' %}";
		  let dateValue  = data.estimatedArrival;
		  if (data.status === "delivered") {
			dateLabel = "{% trans '–î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ' %}";
			dateValue = data.updatedAt ? data.updatedAt.split(" ")[0] : data.estimatedArrival;
		  }

		  // –†–µ–Ω–¥–µ—Ä–∏–º –º–æ–¥–∞–ª–∫—É —Å —Ç–µ–∫—É—â–∏–º –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ–º
		  document.getElementById("modalBody").innerHTML = `
			<div style="line-height:1.6;font-size:16px">
			  <p><strong>üîé ID:</strong> ${data.id}</p>
			  <p><strong>üì¶ {% trans '–°—Ç–∞—Ç—É—Å:' %}</strong> ${statusText}</p>
			  <p><strong>üìÖ ${dateLabel}:</strong> ${dateValue}</p>
			</div>`;
		 document.getElementById("modalFooter").innerHTML = `
			  <div class="btn-box">
			    <a href="/tracking/${data.id}/" class="theme-btn choose-btn">{% trans '–ü–æ–¥—Ä–æ–±–Ω–æ' %}</a>
			  </div>
			`;
		  $('#resultModal').modal('show');
		})
    .catch(err => {
        // —Å—é–¥–∞ –ø–æ–ø–∞–¥–∞—é—Ç —Ç–æ–ª—å–∫–æ –Ω–∞—à–∏ "not found" –∏–ª–∏ —Å–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏
        console.log(err);
    });
});
</script>
<script>
const images = [
	"{% static 'images/background/avia2.jpg' %}",
    "{% static 'images/background/1-2-3-4.jpg' %}",
    "{% static 'images/background/avia1.jpg' %}",
];

let index = 0;
const banner = document.getElementById("bannerCarousel");

// –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞
images.forEach(src => {
    const img = new Image();
    img.src = src;
});

setInterval(() => {
    index = (index + 1) % images.length;
    banner.style.backgroundImage = `url('${images[index]}')`;
}, 5000); // –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
</script>

<!-- –†–µ–∑—É–ª—å—Ç–∏—Ä—É—é—â–∞—è –º–æ–¥–∞–ª–∫–∞ -->
<div class="modal fade" id="resultModal" tabindex="-1" role="dialog"
	 aria-labelledby="resultModalLabel" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered" role="document">
		<div class="modal-content my-modal-content">

			<div class="modal-header my-modal-header">
				<h5 class="modal-title" id="resultModalLabel">
					üì¶ {% trans '–†–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è' %}
				</h5>
				<button type="button" class="close my-modal-close" data-dismiss="modal" aria-label="–ó–∞–∫—Ä—ã—Ç—å">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>

			<div class="modal-body my-modal-body" id="modalBody">
				<p>{% trans '–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶' %}</p>
			</div>

			<div class="modal-footer my-modal-footer">
				<div class="btn-box" id="modalFooter">

				</div>
				<button type="button" class="btn btn-primary" data-dismiss="modal">{% trans '–û–∫' %}</button>
			</div>

		</div>
	</div>
</div>