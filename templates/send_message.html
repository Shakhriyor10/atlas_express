<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–°–æ–∑–¥–∞—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-7">
            <div class="card shadow-lg border-0 rounded-4">
                <div class="card-header bg-primary text-white text-center py-3 rounded-top-4">
                    <h4 class="mb-0">–°–æ–∑–¥–∞—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É</h4>
                </div>
                <div class="card-body p-4">
                    {% if messages %}
                        {% for message in messages %}
                            <div class="alert alert-{{ message.tags|default:'info' }} alert-dismissible fade show" role="alert">
                                {{ message }}
                                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                            </div>
                        {% endfor %}
                    {% endif %}
                    <form method="post" enctype="multipart/form-data">
                        {% csrf_token %}

                        <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
                        <div class="mb-4">
                            <label for="description" class="form-label fw-semibold">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                            <textarea class="form-control rounded-3" id="description" name="description" rows="4" required placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Ä–∞—Å—Å—ã–ª–∫–∏..."></textarea>
                        </div>

                        <!-- –ú–µ–¥–∏–∞-—Ñ–∞–π–ª—ã -->
                        <div class="row g-3">
                            <div class="col-md-4">
                                <label for="image1" class="form-label fw-semibold">–§–∞–π–ª 1 (—Ñ–æ—Ç–æ/–≤–∏–¥–µ–æ)</label>
                                <input type="file" class="form-control rounded-3" id="image1" name="image1" accept="image/*,video/*" onchange="previewMedia(this, 'preview1')">
                                <div id="preview1" class="mt-2 d-none"></div>
                            </div>
                            <div class="col-md-4">
                                <label for="image2" class="form-label fw-semibold">–§–∞–π–ª 2 (—Ñ–æ—Ç–æ/–≤–∏–¥–µ–æ)</label>
                                <input type="file" class="form-control rounded-3" id="image2" name="image2" accept="image/*,video/*" onchange="previewMedia(this, 'preview2')">
                                <div id="preview2" class="mt-2 d-none"></div>
                            </div>
                            <div class="col-md-4">
                                <label for="image3" class="form-label fw-semibold">–§–∞–π–ª 3 (—Ñ–æ—Ç–æ/–≤–∏–¥–µ–æ)</label>
                                <input type="file" class="form-control rounded-3" id="image3" name="image3" accept="image/*,video/*" onchange="previewMedia(this, 'preview3')">
                                <div id="preview3" class="mt-2 d-none"></div>
                            </div>
                        </div>

                        <!-- –ö–Ω–æ–ø–∫–∞ -->
                        <div class="mt-4">
                            <button type="submit" class="btn btn-primary w-100 py-2 rounded-3 fw-bold">
                                üöÄ –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- –ò—Å—Ç–æ—Ä–∏—è —Ä–∞—Å—Å—ã–ª–æ–∫ -->
            {% if recent_messages %}
            <div class="card shadow-sm border-0 rounded-4 mt-5">
                <div class="card-header bg-light d-flex justify-content-between align-items-center rounded-top-4">
                    <h5 class="mb-0">–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ä–∞—Å—Å—ã–ª–∫–∏</h5>
                    <form action="{% url 'logout' %}" method="post" class="m-0">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-sm btn-danger fw-semibold">–í—ã–π—Ç–∏</button>
                    </form>
                </div>
                <div class="card-body">
                    <ul class="list-group list-group-flush">
                        {% for msg in recent_messages %}
                        <li class="list-group-item">
                            <p class="mb-1"><strong>{{ msg.description|truncatewords:15 }}</strong></p>
                            <small class="text-muted">{{ msg.created_at|date:"d.m.Y H:i" }}</small>
                        </li>
                        {% empty %}
                        <li class="list-group-item text-center text-muted">–ù–µ—Ç —Ä–∞—Å—Å—ã–ª–æ–∫</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- JS –¥–ª—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –º–µ–¥–∏–∞ -->
<script>
function previewMedia(input, containerId) {
    const container = document.getElementById(containerId);
    container.innerHTML = '';
    container.classList.add("d-none");

    if (input.files && input.files[0]) {
        const file = input.files[0];
        const url = URL.createObjectURL(file);
        let element;

        if (file.type.startsWith('image/')) {
            element = document.createElement('img');
            element.className = 'img-fluid rounded-3 shadow-sm';
            element.onload = () => URL.revokeObjectURL(url);
        } else if (file.type.startsWith('video/')) {
            element = document.createElement('video');
            element.className = 'w-100 rounded-3 shadow-sm';
            element.controls = true;
            element.onloadeddata = () => URL.revokeObjectURL(url);
        } else {
            const info = document.createElement('p');
            info.className = 'text-muted small';
            info.textContent = '–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è —ç—Ç–æ–≥–æ —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞';
            container.appendChild(info);
            container.classList.remove('d-none');
            return;
        }

        element.src = url;
        container.appendChild(element);
        container.classList.remove('d-none');
    }
}
</script>
</body>
</html>