{% extends 'index-2.html' %}
{% load static %}
{% load i18n dict_utils %}

{% block content %}
<style>
  /* ...—Ç—É—Ç —Ç–æ—Ç –∂–µ CSS, —á—Ç–æ –∏ —É —Ç–µ–±—è... */
  .tracking-container{ position:relative; margin:0 auto; }
  .tracking-line{ position:absolute; left:50%; top:0; bottom:0; width:4px; background:#ccc; transform:translateX(-50%); z-index:1; }
  .tracking-step{ position:relative; margin:60px 0; }
  .tracking-circle{ position:absolute; left:50%; transform:translateX(-50%); width:35px; height:35px; border-radius:50%; background:#ccc; border:4px solid #fff; z-index:2; }
  .tracking-step.completed .tracking-circle{ background:#28a745; }
  .tracking-step.comp-blue .tracking-circle{ background:#fff; }
  .tracking-step.comp-blue .tracking-circle::before{ content:''; position:absolute; top:0; left:0; right:0; bottom:0; background:#1b8af3; border-radius:50%; z-index:-1; animation: blink 1.5s infinite; }
  @keyframes blink { 0%{opacity:1} 50%{opacity:0.3} 100%{opacity:1} }
  .step-label{ position:relative; left:calc(50% + 35px); font-size:16px; color:#333; white-space:nowrap; }
  .step-time { color:#8d8d8d; }
  @media(max-width:480px){
    .step-label{ font-size:12px; left:auto; right:calc(50% + 25px); text-align:right; }
    .step-time{ font-size:10px; }
  }
</style>
<style>
  .tracking-circle {
  width: 28px;
  height: 28px;
  border-radius: 50%;
  border: 2px solid #ccc;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 14px;
}

.tracking-step.completed .tracking-circle {
  background-color: #28a745; /* –∑–µ–ª—ë–Ω—ã–π */
  border-color: #28a745;
  color: #fff;
}

</style>
<div class="sidebar-page-container" style="background-color: white;">
  <div class="auto-container">
    <div class="row clearfix">
      <!--Content Side-->
      <div class="content-side col-lg-12 col-md-12 col-sm-12">
        <div class="track-section">
          <div class="sec-title-two sec-title">
            <h2>{% trans '–ü–æ–∏—Å–∫' %} &amp; <span>{% trans '–æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–Ω–∏–µ –ø–æ—Å—ã–ª–æ–∫' %}</span></h2>
          </div>

          <div class="quote-form-box"></div>

          <div class="track-form-two">
            <form method="post" style="background-color: white; padding: 20px; border-radius: 8px;">
              {% csrf_token %}
              <div class="form-group">
                <label>{% trans '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ ID –ø–æ—Å—ã–ª–∫–∏' %}</label>
              </div>
              <div class="form-group">
                <input type="text" name="trackid" placeholder="Id" required>
                <button type="submit" class="theme-btn submit-btn">{% trans '–ü–æ–∏—Å–∫' %}</button>
              </div>
            </form>
          </div>

          {# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —à–∫–∞–ª—É —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å data (–∑–∞—â–∏—â–∞–µ–º—Å—è –æ—Ç –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ data.* –∫–æ–≥–¥–∞ –µ–≥–æ –Ω–µ—Ç) #}
          {% if data %}
          <div class="container">
            <div class="row">
              <div class="col-12 col-md-4">
                <div class="tracking-container">
                  <div class="tracking-line"></div>

{% for code, label in steps %}
  {% if code != "delivered" %}
    <div class="tracking-step{% if current_index != -1 and forloop.counter0 < current_index %} completed{% elif current_index != -1 and forloop.counter0 == current_index and data.status != 'delivered' %} comp-blue{% endif %}">
<div class="tracking-circle">
  {% if current_index != -1 and forloop.counter0 < current_index %}
    <i class="fa-solid fa-check"></i>
  {% endif %}
</div>
      <div class="step-label">
        {% trans label %}
        <div class="step-time">
          {% if current_index != -1 and forloop.counter0 < current_index %}
            {% trans "–ü—Ä–æ—à–ª–æ" %}
          {% elif code == "accept_location" and current_index != -1 and forloop.counter0 >= current_index %}
            {{ data.arrival_range|default:"‚Äî" }}
          {% elif current_index != -1 and forloop.counter0 == current_index and data.status != "delivered" %}
            {% if data.currentLocation.name %}
              {{ data.currentLocation.name }}
            {% elif data.currentLocation.address %}
              {{ data.currentLocation.address }}
            {% else %}
              ‚Äî
            {% endif %}
          {% else %}
            {% trans "–û–∂–∏–¥–∞–µ—Ç—Å—è" %}
          {% endif %}
        </div>
      </div>
    </div>
  {% endif %}
{% endfor %}

                  {# –¥–æ–±–∞–≤–ª—è–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —à–∞–≥ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Å—Ç–∞—Ç—É—Å –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ #}
                  {% if data.status == "delivered" %}
  <div class="tracking-step completed">
    <div class="tracking-circle">
      <i class="fa-solid fa-check"></i>
    </div>
    <div class="step-label">
      {% trans "–î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ" %}
      <div class="step-time">{{ data.updatedDateOnly }}</div>
    </div>
  </div>
{% endif %}

                </div>
              </div>
            </div>
          </div>
          {% endif %} {# –∫–æ–Ω–µ—Ü if data –¥–ª—è —à–∫–∞–ª—ã #}

          <div class="map-outer"></div>

        </div>
      </div>
      <!--/Content Side-->
    </div>
          {% if data %}
<div class="d-flex justify-content-center align-items-center" style="min-height: 80vh;">
  <div class="card shadow-lg w-100" style="max-width: 520px; font-size: 1.1rem;">
    <div class="card-header text-center font-weight-bold text-white" style="font-size: 1.3rem; background-color: #005e93;">
      üîé {% trans '–ù–æ–º–µ—Ä —Å—á–µ—Ç–∞:' %} {{ data.id }}
    </div>
    <div class="card-body">
      <h5 class="card-title mb-3" style="font-size: 1.25rem;">
        {% trans '–í–∞—à —Ç–∞—Ä–∏—Ñ:' %} <span class="font-weight-bold">{{ data.shipmentType.name }}</span>
      </h5>

      <p class="mb-3" style="font-size: 1.15rem;">
        üì¶ <strong>{% trans '–°—Ç–∞—Ç—É—Å:' %}</strong>
        {% if data.status == "in_warehouse" %}
          {% trans "–ù–∞ —Å–∫–ª–∞–¥–µ" %}
        {% elif data.status == "location" %}
          {% trans "–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ" %}
        {% elif data.status == "packed" %}
          {% trans "–£–ø–∞–∫–æ–≤–∞–Ω" %}
        {% elif data.status == "shipped" %}
          {% trans "–û—Ç–ø—Ä–∞–≤–ª–µ–Ω" %}
        {% elif data.status == "in_customs" %}
          {% trans "–ù–∞ —Ç–∞–º–æ–∂–Ω–µ" %}
        {% elif data.status == "arrive_warehouse" %}
          {% trans "–ü—Ä–∏–±—ã–ª –Ω–∞ —Å–∫–ª–∞–¥" %}
        {% elif data.status == "accept_location" %}
          {% trans "–ü—Ä–∏–Ω—è—Ç–æ –≤ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ" %}
        {% elif data.status == "delivered" %}
          {% trans "–î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ" %}
        {% else %}
          {{ data.status }}
        {% endif %}
      </p>

      {% if data.status != "delivered" %}
        <p class="mb-3" style="font-size: 1.15rem;">
          üìç <strong>{% trans '–¢–µ–∫—É—â–µ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:' %}</strong><br>
          {{ data.currentLocation.address|default:"‚Äî" }}
        </p>
        <p style="font-size: 1.15rem;">
          ‚è≥ <strong>{% trans '–î–æ—Å—Ç–∞–≤–∫–∞ –±—É–¥–µ—Ç –æ—Å—É—â–µ—Å—Ç–≤–ª–µ–Ω–∞:' %}</strong><br>
          {{ data.arrival_range|default:"‚Äî" }}
        </p>
      {% else %}
        <p style="font-size: 1.15rem;">
          ‚úÖ <strong>{% trans '–î–æ—Å—Ç–∞–≤–ª–µ–Ω:' %}</strong><br>
          {{ data.updatedDateOnly }}
        </p>
      {% endif %}
    </div>
  </div>
</div>
{% endif %}
  </div>
</div>
{% block counter_section %}
{% endblock %}

{# –æ—Ç–¥–µ–ª—å–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ —Å –¥–µ—Ç–∞–ª—è–º–∏ (–æ–Ω–∞ —É —Ç–µ–±—è –±—ã–ª–∞ –Ω–∏–∂–µ) #}

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const stepTimes = document.querySelectorAll(".step-time");
    stepTimes.forEach(function (el) {
      const text = el.textContent.trim();
      if (text.length > 20) {
        const spaceIndex = text.indexOf(" ", 20);
        if (spaceIndex !== -1) {
          const firstLine = text.slice(0, spaceIndex);
          const secondLine = text.slice(spaceIndex + 1);
          el.innerHTML = firstLine + "<br>" + secondLine;
        }
      }
    });
  });
</script>

{% endblock %}
